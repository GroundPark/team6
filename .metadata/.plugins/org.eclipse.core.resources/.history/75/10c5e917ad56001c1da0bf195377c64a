package challenge.dao;

import static challenge.db.JdbcUtil.*;	
import java.util.*;
import java.sql.*;
import challenge.dao.*;
import vo.*;

public class ChallengeGoodableDao {
	private static ChallengeGoodableDao challengeGoodableDao;
	private Connection conn;
	
	private ChallengeGoodableDao() {}
	public static ChallengeGoodableDao getInstance() {
	// singleton
		if(challengeGoodableDao == null)		challengeGoodableDao = new ChallengeGoodableDao();
		return challengeGoodableDao;
	}
	
	public void setConnection(Connection conn) {
		this.conn = conn;
	}
	
	public int getChallengeGoodable(int idx, String miid) {
		Statement stmt = null;
		ResultSet rs = null;
		int result = 0;
		String sql = "";

		try {
			// 좋아요 여부 구하기
			sql = "select cg_history from t_challenge_good where ci_idx = " + idx 
					+ " and mi_id = '" + miid + "' order by cg_idx desc limit 1 ";

			 rs = stmt.executeQuery(sql); 		// select 실행하여 있으면 0, 1을 받는데 Null이어도 0을 받음
			 
			 if (rs.wasNull()) {
				 result = 0;				// null 이면 0
			 }else if (rs.next()) {
				 result = rs.getInt(1);		// 0 또는 1을 적절하게 가져옴
			 }
		}catch(Exception e) {
			e.printStackTrace();
		}finally {
			close(rs);		
			close(stmt);
		}
		
		return result;
	}
}